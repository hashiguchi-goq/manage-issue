name: Issue Metrics

on:
  push

permissions:
  issues: write
  pull-requests: read

env:
  API_TOKEN: ${{ secrets.NEW_API_TOKEN }}

jobs:
  build:
    name: issue metrics
    runs-on: ubuntu-latest

    steps:
      - name: Get issue metrics 202209
        uses: github/issue-metrics@v2
        env:
          GH_TOKEN: ${{ env.API_TOKEN }}
          SEARCH_QUERY: 'repo:GoQSystemInc/GoQSystemOrder is:issue label:"不具合" created:2022-09-01..2022-09-30 assignee:fujita-goq'

      - name: Create issue 202209
        uses: peter-evans/create-issue-from-file@v4
        with:
          title: 2022年9月の不具合ケース（藤田）
          token: ${{ secrets.GITHUB_TOKEN }}
          content-filepath: ./issue_metrics.md
          assignees: <YOUR_GITHUB_HANDLE_HERE>

      - name: Get issue metrics 202210
        uses: github/issue-metrics@v2
        env:
          GH_TOKEN: ${{ env.API_TOKEN }}
          SEARCH_QUERY: 'repo:GoQSystemInc/GoQSystemOrder is:issue label:"不具合" created:2022-10-01..2022-10-31 assignee:fujita-goq'

      - name: Create issue 202210
        uses: peter-evans/create-issue-from-file@v4
        with:
          title: 2022年10月の不具合ケース（藤田）
          token: ${{ secrets.GITHUB_TOKEN }}
          content-filepath: ./issue_metrics.md
          assignees: <YOUR_GITHUB_HANDLE_HERE>